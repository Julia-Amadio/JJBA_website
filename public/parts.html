<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Enciclopédia JoJo - Episódios</title>
    <!-- Garante que os estilos externos (incluindo os novos) sejam carregados -->
    <link rel="stylesheet" href="style.css"> 
    <script src="global.js" defer></script>
</head>
<body>
    <header>
        <h1>Enciclopédia JJBA - Episódios por Parte</h1>
        <nav>
            <a href="index.html">Início</a>
            <a href="characters.html">Personagens</a>
            <a href="stands.html">Stands</a>
            <b>Partes</b>
            <a href="nationality.html">Dashboard</a>
        </nav>
    </header>

    <main>
        <!-- O container principal onde as partes e episódios serão inseridos -->
        <div id="lista-partes-container">
            <p style="text-align: center;">Carregando episódios...</p>
        </div>
    </main>

    <script>
        async function carregarPartesEepisodios() {
            const container = document.getElementById('lista-partes-container');
            container.innerHTML = ''; // Limpa o "Carregando..."

            try {
                // 1. Chama a rota da API que busca tudo agrupado
                const response = await fetch('/api/partes-com-episodios');
                if (!response.ok) {
                    throw new Error('Falha na API de partes.');
                }
                const partes = await response.json(); 

                // 2. Itera sobre cada Parte (Phantom Blood, Battle Tendency, etc.)
                partes.forEach(parte => {
                    // Cria o container principal para a Parte (usará a classe CSS .parte-container)
                    const divParte = document.createElement('section');
                    divParte.className = 'parte-container';

                    // Título da Parte
                    const h2Titulo = document.createElement('h2');
                    // Usa a classe CSS .parte-titulo
                    h2Titulo.className = 'parte-titulo';
                    h2Titulo.textContent = `Parte ${parte.numero}: ${parte.nome}`;
                    divParte.appendChild(h2Titulo);

                    // ==========================================================
                    // INCLUSÃO DA DESCRIÇÃO DA PARTE
                    // ==========================================================
                    const pDescricao = document.createElement('p');
                    // Usa a nova classe CSS .parte-descricao
                    pDescricao.className = 'parte-descricao';
                    pDescricao.textContent = parte.descricao || 'Descrição não disponível.';
                    divParte.appendChild(pDescricao);
                    // ==========================================================


                    // Container para a lista de episódios (usará a classe CSS .episodio-lista)
                    const divListaEpisodios = document.createElement('div');
                    divListaEpisodios.className = 'episodio-lista';

                    // 3. Itera sobre os episódios dentro daquela Parte
                    parte.episodios.forEach(ep => {
                        // Cria o "card" do episódio (usará a classe CSS .episodio-item)
                        const divEpisodio = document.createElement('div');
                        divEpisodio.className = 'episodio-item';

                        // Título do episódio (Número e Nome)
                        const h3EpTitulo = document.createElement('h3');
                        h3EpTitulo.textContent = `Ep. ${ep.numero}: ${ep.nome}`;
                        
                        // Descrição do episódio
                        const pEpDescricao = document.createElement('p');
                        pEpDescricao.textContent = ep.descricao || 'Descrição não disponível.';

                        // Adiciona ao "card"
                        divEpisodio.appendChild(h3EpTitulo);
                        divEpisodio.appendChild(pEpDescricao);

                        // Adiciona o "card" à lista da parte
                        divListaEpisodios.appendChild(divEpisodio);
                    });

                    // Adiciona a lista de episódios ao container da Parte
                    divParte.appendChild(divListaEpisodios);
                    
                    // Adiciona o container da Parte ao container principal da página
                    container.appendChild(divParte);
                });

            } catch (error) {
                console.error('Falha ao carregar partes e episódios:', error);
                container.innerHTML = '<h2 style="text-align: center; color: #f7a0ff;">Erro ao carregar dados.</h2>';
            }
        }

        // Inicia a função quando a página carregar
        window.onload = carregarPartesEepisodios;
    </script>

    <footer>
        <p>Projeto desenvolvido pelos alunos João Bastasini, Julia Amadio e Thiago Uliame para a disciplina de Bancos de Dados II.</p>
    </footer>
</body>
</html>
