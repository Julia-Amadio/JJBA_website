<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Enciclopédia JoJo</title>
    <link rel="stylesheet" href="style.css">
    <script src="global.js" defer></script>
</head>
<body>
    <header>
        <h1>Enciclopédia JJBA - Personagens</h1>
        <nav>
            <a href="index.html">Início</a>
            <a href="stands.html">Stands</a>
            <!-- <a href="battles.html">Batalhas</a> -->
            <a href="parts.html">Partes</a>
        </nav>
    </header>

    <main>
        <section>
            <h2 style="text-align: center;">Lista de personagens</h2>
            <div id="lista-personagens"></div>
        </section>
    </main>

    <script>
        async function carregarListaPersonagens() {
            const divLista = document.getElementById('lista-personagens');
            try {
                //1. Busca a lista de nomes da nova API
                const response = await fetch('/api/personagens');
                const personagens = await response.json(); //Ex: [{nome: 'Dio Brando'}, {nome: 'Giorno Giovanna'}, ...]

                let letraAtual = ''; //Para controlar o agrupamento A, B, C...

                //2. Itera sobre cada personagem retornado
                personagens.forEach(personagem => {
                    const primeiraLetra = personagem.nome[0].toUpperCase();

                    //3. Se é uma letra nova, cria o cabeçalho
                    if (primeiraLetra !== letraAtual) {
                        letraAtual = primeiraLetra;

                        //Adiciona um separador (exceto antes da letra 'A')
                        if (divLista.children.length > 0) {
                            divLista.appendChild(document.createElement('hr'));
                        }

                        const headerLetra = document.createElement('h2');
                        headerLetra.textContent = letraAtual;
                        divLista.appendChild(headerLetra);
                    }

                    //4. Cria o link para a página de detalhe
                    const link = document.createElement('a');
                    link.textContent = personagem.nome;
                    link.className = 'link-personagem';

                    //Passa o nome do personagem como um "parâmetro de URL"
                    link.href = 'character-detail.html?nome=' + encodeURIComponent(personagem.nome);

                    divLista.appendChild(link);
                });

            } catch (error) {
                console.error('Falha ao carregar personagens:', error);
                divLista.textContent = 'Erro ao carregar lista de personagens.';
            }
        }

        //Inicia a função quando a página carregar
        window.onload = carregarListaPersonagens;
    </script>

    <footer>
        <p>Projeto desenvolvido pelos alunos João Bastasini, Julia Amadio e Thiago Uliame para a disciplina de Bancos de Dados II.</p>
    </footer>
</body>
</html>